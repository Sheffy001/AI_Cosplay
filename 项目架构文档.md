## 1. 项目概述

**AI_Cosplay** 是一个面向图像处理和在线交互的服务端项目，提供用户上传、AI 处理（如图像生成、修复、风格化等）以及 HTTPS 安全访问功能。
 项目核心目标是提供高性能、可扩展的图像处理服务，支持并发请求，并保证数据安全和网络传输安全。

------

## 2. 技术栈

| 模块         | 技术/库                                    | 功能描述                                              | 负责人 |
| ------------ | ------------------------------------------ | ----------------------------------------------------- | ------ |
| 网络通信     | [Muduo](https://github.com/chenshuo/muduo) | 高性能 TCP 服务器框架，支持事件驱动和多线程           | 谢菲   |
| 加密传输     | OpenSSL                                    | 支持 TLS1.2/1.3，保证 HTTPS 安全                      | 谢菲   |
| 客户端页面   | html、js                                   | 支持图像生成、修复和风格化操作                        | 陈家辉 |
| 日志         | Muduo Logging                              | 统一日志管理                                          | 谢菲   |
| 数据存储     | MySQL                                      | 用户数据、聊天记录和英雄故事,数据库连接池增加运行效率 | 谢菲   |
| HTTP服务框架 | HTTP框架实现                               | 基于muduo的http服务框架，包括路由注册会话管理等等     | 谢菲   |

------

## 3. 项目目录结构（示例）

```
AI_Cosplay/
├── bin/                    # 可执行文件及证书/私钥
├── build/                  # 编译输出目录
├── include/                # 头文件
│   ├── HttpServer.h
│   ├── SslConfig.h
│   └── ...
├── src/                    # 源代码
│   ├── HttpServer.cpp
│   ├── SslConnection.cpp
│   ├── RouterHandler.cpp
│   └── ...
├── aiserver                #路由注册和服务主地址
├── CMakeLists.txt          ## 构建/部署/测试脚本
└── README.md
```

------

## 4. 系统模块设计

### 4.1 网络层

- **HttpServer**: 基于 Muduo 的 HTTP 服务类，支持线程池和多连接并发处理。
- **TcpConnection**: 维护每个 TCP 连接对象。
- **SSL/TLS 支持**:
  - `SslContext` 管理证书、私钥和加密协议
  - `SslConnection` 封装 OpenSSL 的 BIO 操作，实现异步 TLS 握手和数据加解密
  - 支持 TLS1.2 和 TLS1.3，可处理客户端握手和加密传输。

------

### 4.2 HTTP 层

- `HttpContext`: 解析 HTTP 请求报文，封装为 `HttpRequest` 对象
- `HttpRequest`/`HttpResponse`: 表示请求和响应
- 路由机制：通过注册不同路径的回调函数实现路由处理
- 支持 GET、POST 等常用 HTTP 方法

------

### 4.3日志与监控

- 使用 Muduo Logging 输出 INFO/DEBUG/ERROR 等日志
- 支持日志级别配置，便于开发和生产环境调试

------

### 4.4数据存储层

- 使用mysql存储用户信息、聊天消息、英雄故事等等
- 使用mysql连接池提高性能



------

## 5. 流程设计

1. **客户端发起 HTTPS 请求**
2. **TcpConnection 创建连接**
3. **SslConnection 启动 TLS 握手**
   - handshake 完成后，状态变为 ESTABLISHED
4. **HttpServer 接收解密后的数据**
5. **HttpContext 解析 HTTP 请求**
6. **请求分发到相应路由 / AI 模型处理**
7. **生成响应报文并通过 SslConnection 加密**
8. **发送加密数据回客户端**

------

## 7. SSL/TLS 配置

- **证书路径**: `/home/sheffy/CppProject/AIChat/bin/server.crt`
- **私钥路径**: `/home/sheffy/CppProject/AIChat/bin/server.key`
- **支持协议**: TLS1.2 默认
- **BIO 类型**: 内存 BIO，异步处理网络数据
- **握手方式**: 非阻塞异步 handshake
- **验证方式**: 单向验证（服务器证书），可选双向验证

------

## 8. 部署建议

- 端口：8443（HTTPS）
- 多线程处理：建议线程数 = CPU 核数 × 2
- 日志级别：开发环境 DEBUG，生产环境 INFO/ERROR
- 安全建议：
  - 使用强密码加密算法（ECDHE-RSA-AES256-GCM-SHA384）
  - 定期更新证书

------

## 9. 扩展与优化

1. **支持 TLS 1.3**
2. **增加缓存层**：使用redis做用户热点聊天消息缓存
3. **支持 WebSocket** 客户端ai语音实时阅读
4. **支持更多角色**；
5. **请求限流** 避免恶意访问
6. **后端ai请求响应**